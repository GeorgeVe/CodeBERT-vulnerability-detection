#!/bin/bash
#
#SBATCH --job-name="Fine-tune-UniXCoder"
#SBATCH --partition=gpu
#SBATCH --time=23:00:00
#SBATCH --ntasks=1
#SBATCH --cpus-per-task=24
#SBATCH --gpus-per-task=2
#SBATCH --mem-per-cpu=1G
#SBATCH --account=education-eemcs-courses-in4334

module load 2022r2
module load openmpi
module load py-torch
module load py-numpy
module load py-scikit-learn
module load py-pip

echo "-> Starting python download" >> "result.txt"

python -m pip install --user transformers >> "result.txt"

echo "---Starting script:  $(date '+%X')" >> "result.txt"
srun python run.py --output_dir saved_models --model_name_or_path microsoft/unixcoder-base-nine --do_train --train_data_file datasetfull/train.txt --eval_data_file datasetfull/valid.txt --num_train_epochs 1 --block_size 512 --train_batch_size 16 --eval_batch_size 32 --learning_rate 5e-5 --max_grad_norm 1.0 --seed 123456 >> "result.txt"
echo "done ($(date '+%X'))... \n--------------------"